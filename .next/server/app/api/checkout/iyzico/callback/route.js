(()=>{var e={};e.id=2404,e.ids=[2404],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31183:(e,t,r)=>{"use strict";r.d(t,{z:()=>a});var o=r(96330);let a=global.prisma||new o.PrismaClient({log:["error"]})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},58166:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>l,serverHooks:()=>h,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>y});var o={};r.r(o),r.d(o,{POST:()=>p});var a=r(96559),i=r(48088),s=r(37719),n=r(32190),c=r(31183),u=r(65862);async function p(e){try{let t=(await e.formData()).get("token");if(!t)return n.NextResponse.json({error:"Token bilgisi gerekli."},{status:400});let r=await c.z.order.findFirst({where:{paymentId:t,paymentMethod:"IYZICO"}});if(!r)return n.NextResponse.json({error:"Sipariş bulunamadı."},{status:404});let o=await c.z.setting.findFirst();if(!o?.iyzicoKey||!o?.iyzicoSecretKey)return n.NextResponse.json({error:"Iyzico API bilgileri ayarlanmamış."},{status:400});let a=(0,u.iT)(o.iyzicoKey,o.iyzicoSecretKey,!!o.iyzicoSandboxMode),i=await (0,u.LR)(a,t);if("SUCCESS"===i.paymentStatus)return await c.z.order.update({where:{id:r.id},data:{status:"PROCESSING"}}),n.NextResponse.redirect(`${process.env.NEXT_PUBLIC_APP_URL}/checkout/success?orderId=${r.id}`);return await c.z.order.update({where:{id:r.id},data:{status:"CANCELLED"}}),n.NextResponse.redirect(`${process.env.NEXT_PUBLIC_APP_URL}/checkout/error?orderId=${r.id}&error=${i.errorMessage||"\xd6deme işlemi başarısız oldu."}`)}catch(e){return console.error("Iyzico callback hatası:",e),n.NextResponse.redirect(`${process.env.NEXT_PUBLIC_APP_URL}/checkout/error?error=${e.message||"\xd6deme sonucu işlenirken bir hata oluştu."}`)}}let l=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/checkout/iyzico/callback/route",pathname:"/api/checkout/iyzico/callback",filename:"route",bundlePath:"app/api/checkout/iyzico/callback/route"},resolvedPagePath:"C:\\Users\\Administrator\\Desktop\\restoran\\src\\app\\api\\checkout\\iyzico\\callback\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:d,workUnitAsyncStorage:y,serverHooks:h}=l;function m(){return(0,s.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:y})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65862:(e,t,r)=>{"use strict";r.d(t,{LR:()=>u,iT:()=>i,lt:()=>c,sR:()=>n});var o=r(55511),a=r.n(o);function i(e,t,r=!1){return console.log("İyzico config oluşturuldu - Sandbox modu:",r?"Aktif":"Kapalı"),{apiKey:e,secretKey:t,baseUrl:r?"https://sandbox-api.iyzipay.com":"https://api.iyzipay.com"}}async function s(e,t,r,o={}){let i=`${e.baseUrl}${r}`,n=function(e,t,r={}){let o=Math.random().toString(10).substring(2);r="string"==typeof r?r:JSON.stringify(r);let i=`[${o}${e.apiKey}${t}${r}${e.secretKey}]`,s=a().createHash("sha1").update(i).digest("base64");return`IYZWS ${e.apiKey}:${s}`}(e,r,o);try{let e=await fetch(i,{method:t,headers:{"Content-Type":"application/json",Authorization:n,Accept:"application/json","x-iyzi-client-version":"iyzico-node-client-1.0.0"},body:"GET"!==t?JSON.stringify(o):void 0}),r=await e.json();if("success"!==r.status)throw Error(r.errorMessage||"Iyzico API isteği başarısız oldu");return r}catch(e){throw console.error("Iyzico API hatası:",e),e}}async function n(e){try{console.log("İyzico bağlantı testi yapılıyor:",e.baseUrl);let t=await s(e,"GET","/payment/test");return console.log("İyzico test sonucu:",t),"success"===t.status}catch(e){return console.error("Iyzico bağlantı testi hatası:",e),!1}}async function c(e,t){try{return await s(e,"POST","/payment/iyzipos/checkoutform/initialize",t)}catch(e){throw console.error("Iyzico \xf6deme formu oluşturma hatası:",e),e}}async function u(e,t){try{return await s(e,"POST","/payment/iyzipos/checkoutform/auth/ecom/detail",{token:t})}catch(e){throw console.error("Iyzico \xf6deme sorgulama hatası:",e),e}}},78335:()=>{},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[4243,580],()=>r(58166));module.exports=o})();