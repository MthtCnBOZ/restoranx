(()=>{var e={};e.id=6902,e.ids=[6902],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},12909:(e,r,t)=>{"use strict";t.d(r,{N:()=>c,p:()=>u});var s=t(16467),i=t(35426),a=t(13581),o=t(85663),n=t(31183);let c={adapter:(0,s.y)(n.z),session:{strategy:"jwt",maxAge:2592e3},pages:{signIn:"/giris"},providers:[(0,a.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Şifre",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let r=await n.z.user.findUnique({where:{email:e.email}});return r&&r.password&&await (0,o.UD)(e.password,r.password)?(console.log("Giriş başarılı. Kullanıcı:",{id:r.id,email:r.email,name:r.name,role:r.role}),{id:r.id,email:r.email,name:r.name,role:r.role}):null}})],callbacks:{jwt:async({token:e,user:r,account:t})=>(console.log("JWT callback \xe7alışıyor"),console.log("User bilgisi:",r),console.log("\xd6nceki token:",e),r&&(e.id=r.id,e.role=r.role,console.log("JWT'ye yeni bilgiler eklendi:",e)),e),session:async({session:e,token:r})=>(console.log("Session callback \xe7alışıyor"),console.log("Token:",r),r&&(e.user.id=r.id,e.user.role=r.role,console.log("Session g\xfcncellenmiş hali:",e)),e)},debug:!1},u=()=>(0,i.getServerSession)(c)},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31183:(e,r,t)=>{"use strict";t.d(r,{z:()=>i});var s=t(96330);let i=global.prisma||new s.PrismaClient({log:["error"]})},35950:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>p});var i=t(96559),a=t(48088),o=t(37719),n=t(32190),c=t(12909),u=t(31183),l=t(65862);async function p(e){try{if(!await (0,c.p)())return n.NextResponse.json({error:"Bu işlem i\xe7in giriş yapmalısınız."},{status:401});let{orderId:r,callbackUrl:t}=await e.json();if(!r)return n.NextResponse.json({error:"Sipariş ID zorunludur."},{status:400});let s=await u.z.order.findUnique({where:{id:r},include:{user:!0,orderitem:{include:{product:!0}}}});if(!s)return n.NextResponse.json({error:"Sipariş bulunamadı."},{status:404});let i=await u.z.setting.findFirst();if(!i?.iyzicoKey||!i?.iyzicoSecretKey)return n.NextResponse.json({error:"Iyzico API bilgileri ayarlanmamış."},{status:400});let a=(0,l.iT)(i.iyzicoKey,i.iyzicoSecretKey,!!i.iyzicoSandboxMode),o=s.orderitem.map(e=>({id:e.id,name:e.product.name,category1:"Yemek",itemType:"PHYSICAL",price:e.price.toString()})),p=e.headers.get("x-forwarded-for")||"85.34.78.112",d={locale:"tr",conversationId:r,price:s.total.toString(),paidPrice:s.total.toString(),currency:"TRY",basketId:r,paymentGroup:"PRODUCT",callbackUrl:t||`${process.env.NEXT_PUBLIC_APP_URL}/checkout/result`,enabledInstallments:[1,2,3,6,9],buyer:{id:s.user.id,name:s.user.name?.split(" ")[0]||"İsimsiz",surname:s.user.name?.split(" ").slice(1).join(" ")||"Kullanıcı",gsmNumber:s.phone||"+905555555555",email:s.user.email,identityNumber:"11111111111",registrationAddress:s.address||"Adres bilgisi yok",ip:p,city:"Istanbul",country:"Turkey"},shippingAddress:{contactName:s.user.name||"İsimsiz Kullanıcı",city:"Istanbul",country:"Turkey",address:s.address||"Adres bilgisi yok"},billingAddress:{contactName:s.user.name||"İsimsiz Kullanıcı",city:"Istanbul",country:"Turkey",address:s.address||"Adres bilgisi yok"},basketItems:o},y=await (0,l.lt)(a,d);return await u.z.order.update({where:{id:r},data:{paymentId:y.token,paymentMethod:"IYZICO"}}),n.NextResponse.json(y,{status:200})}catch(e){return console.error("Iyzico \xf6deme hatası:",e),n.NextResponse.json({error:e.message||"\xd6deme işlemi sırasında bir hata oluştu."},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/checkout/iyzico/route",pathname:"/api/checkout/iyzico",filename:"route",bundlePath:"app/api/checkout/iyzico/route"},resolvedPagePath:"C:\\Users\\Administrator\\Desktop\\restoran\\src\\app\\api\\checkout\\iyzico\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:m,serverHooks:g}=d;function h(){return(0,o.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:m})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65862:(e,r,t)=>{"use strict";t.d(r,{LR:()=>u,iT:()=>a,lt:()=>c,sR:()=>n});var s=t(55511),i=t.n(s);function a(e,r,t=!1){return console.log("İyzico config oluşturuldu - Sandbox modu:",t?"Aktif":"Kapalı"),{apiKey:e,secretKey:r,baseUrl:t?"https://sandbox-api.iyzipay.com":"https://api.iyzipay.com"}}async function o(e,r,t,s={}){let a=`${e.baseUrl}${t}`,n=function(e,r,t={}){let s=Math.random().toString(10).substring(2);t="string"==typeof t?t:JSON.stringify(t);let a=`[${s}${e.apiKey}${r}${t}${e.secretKey}]`,o=i().createHash("sha1").update(a).digest("base64");return`IYZWS ${e.apiKey}:${o}`}(e,t,s);try{let e=await fetch(a,{method:r,headers:{"Content-Type":"application/json",Authorization:n,Accept:"application/json","x-iyzi-client-version":"iyzico-node-client-1.0.0"},body:"GET"!==r?JSON.stringify(s):void 0}),t=await e.json();if("success"!==t.status)throw Error(t.errorMessage||"Iyzico API isteği başarısız oldu");return t}catch(e){throw console.error("Iyzico API hatası:",e),e}}async function n(e){try{console.log("İyzico bağlantı testi yapılıyor:",e.baseUrl);let r=await o(e,"GET","/payment/test");return console.log("İyzico test sonucu:",r),"success"===r.status}catch(e){return console.error("Iyzico bağlantı testi hatası:",e),!1}}async function c(e,r){try{return await o(e,"POST","/payment/iyzipos/checkoutform/initialize",r)}catch(e){throw console.error("Iyzico \xf6deme formu oluşturma hatası:",e),e}}async function u(e,r){try{return await o(e,"POST","/payment/iyzipos/checkoutform/auth/ecom/detail",{token:r})}catch(e){throw console.error("Iyzico \xf6deme sorgulama hatası:",e),e}}},66541:e=>{"use strict";e.exports=require("@prisma/client/runtime/library")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},94735:e=>{"use strict";e.exports=require("events")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4243,580,5663,5252],()=>t(35950));module.exports=s})();