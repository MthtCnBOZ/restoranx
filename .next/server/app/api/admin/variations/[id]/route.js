(()=>{var e={};e.id=7674,e.ids=[7674],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12269:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},12412:e=>{"use strict";e.exports=require("assert")},12909:(e,t,r)=>{"use strict";r.d(t,{N:()=>u,p:()=>d});var a=r(16467),i=r(35426),o=r(13581),n=r(85663),s=r(31183);let u={adapter:(0,a.y)(s.z),session:{strategy:"jwt",maxAge:2592e3},pages:{signIn:"/giris"},providers:[(0,o.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Şifre",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await s.z.user.findUnique({where:{email:e.email}});return t&&t.password&&await (0,n.UD)(e.password,t.password)?(console.log("Giriş başarılı. Kullanıcı:",{id:t.id,email:t.email,name:t.name,role:t.role}),{id:t.id,email:t.email,name:t.name,role:t.role}):null}})],callbacks:{jwt:async({token:e,user:t,account:r})=>(console.log("JWT callback \xe7alışıyor"),console.log("User bilgisi:",t),console.log("\xd6nceki token:",e),t&&(e.id=t.id,e.role=t.role,console.log("JWT'ye yeni bilgiler eklendi:",e)),e),session:async({session:e,token:t})=>(console.log("Session callback \xe7alışıyor"),console.log("Token:",t),t&&(e.user.id=t.id,e.user.role=t.role,console.log("Session g\xfcncellenmiş hali:",e)),e)},debug:!1},d=()=>(0,i.getServerSession)(u)},19854:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o.default}});var i=r(12269);Object.keys(i).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(a,e))&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))});var o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var a={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&({}).hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(a,o,s):a[o]=e[o]}return a.default=e,r&&r.set(e,a),a}(r(35426));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}Object.keys(o).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(a,e))&&(e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))})},23870:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var a=r(55511);let i={randomUUID:a.randomUUID},o=new Uint8Array(256),n=o.length,s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));let u=function(e,t,r){if(i.randomUUID&&!t&&!e)return i.randomUUID();let u=(e=e||{}).random??e.rng?.()??(n>o.length-16&&((0,a.randomFillSync)(o),n=0),o.slice(n,n+=16));if(u.length<16)throw Error("Random bytes length must be >= 16");if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=u[e];return t}return function(e,t=0){return(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase()}(u)}},26362:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>m,serverHooks:()=>A,workAsyncStorage:()=>E,workUnitAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{DELETE:()=>f,GET:()=>v,PATCH:()=>y});var i=r(96559),o=r(48088),n=r(37719),s=r(32190),u=r(96330),d=r(23870),l=r(19854),p=r(12909);let c=new u.PrismaClient;async function v(e,{params:t}){try{let e=await (0,l.getServerSession)(p.N);if(!e||"ADMIN"!==e.user.role)return s.NextResponse.json({error:"Yetkisiz erişim"},{status:401});let{id:r}=t,a=await c.$queryRaw`
      SELECT v.*, vo.id as optionId, vo.name as optionName, vo.price, vo.isDefault, vo.createdAt as optionCreatedAt, vo.updatedAt as optionUpdatedAt
      FROM variation v
      LEFT JOIN variationoption vo ON v.id = vo.variationId
      WHERE v.id = ${r}
      ORDER BY vo.createdAt ASC
    `;if(!Array.isArray(a)||0===a.length)return s.NextResponse.json({error:"Varyasyon bulunamadı"},{status:404});let i=await c.$queryRaw`
      SELECT pv.*, p.name as productName, p.image as productImage
      FROM productvariation pv
      JOIN product p ON pv.productId = p.id
      WHERE pv.variationId = ${r}
    `,o={id:a[0].id,name:a[0].name,description:a[0].description,createdAt:a[0].createdAt,updatedAt:a[0].updatedAt,variationoption:a[0].optionId?a.map(e=>({id:e.optionId,variationId:e.id,name:e.optionName,price:e.price,isDefault:e.isDefault,createdAt:e.optionCreatedAt,updatedAt:e.optionUpdatedAt})):[],productvariation:Array.isArray(i)?i.map(e=>({id:e.id,productId:e.productId,variationId:e.variationId,createdAt:e.createdAt,updatedAt:e.updatedAt,product:{id:e.productId,name:e.productName,image:e.productImage}})):[]};return s.NextResponse.json({variation:o})}catch(e){return console.error("Varyasyon alınırken hata:",e),s.NextResponse.json({error:"Varyasyon alınırken bir hata oluştu"},{status:500})}}async function y(e,{params:t}){try{let r=await (0,l.getServerSession)(p.N);if(!r||"ADMIN"!==r.user.role)return s.NextResponse.json({error:"Yetkisiz erişim"},{status:401});let{id:a}=t,{name:i,description:o,options:n}=await e.json();if(!i||!n||!Array.isArray(n)||0===n.length)return s.NextResponse.json({error:"Varyasyon adı ve en az bir se\xe7enek zorunludur"},{status:400});let u=await c.$queryRaw`
      SELECT * FROM variation WHERE id = ${a}
    `;if(!Array.isArray(u)||0===u.length)return s.NextResponse.json({error:"Varyasyon bulunamadı"},{status:404});let v=await c.$queryRaw`
      SELECT * FROM variationoption WHERE variationId = ${a}
    `;await c.$executeRaw`
      UPDATE variation 
      SET name = ${i}, description = ${o}, updatedAt = NOW() 
      WHERE id = ${a}
    `;let y=v.map(e=>e.id),f=n.filter(e=>e.id&&y.includes(e.id)),m=n.filter(e=>!e.id),E=f.map(e=>e.id),g=y.filter(e=>!E.includes(e));if(g.length>0)for(let e of g)await c.$executeRaw`DELETE FROM variationoption WHERE id = ${e}`;for(let e of f)await c.$executeRaw`
        UPDATE variationoption 
        SET name = ${e.name}, price = ${parseFloat(e.price||"0")}, isDefault = ${e.isDefault||!1}, updatedAt = NOW()
        WHERE id = ${e.id}
      `;for(let e of m){let t=(0,d.A)();await c.$executeRaw`
        INSERT INTO variationoption (id, variationId, name, price, isDefault, createdAt, updatedAt)
        VALUES (${t}, ${a}, ${e.name}, ${parseFloat(e.price||"0")}, ${e.isDefault||!1}, NOW(), NOW())
      `}let A=await c.$queryRaw`
      SELECT v.*, vo.id as optionId, vo.name as optionName, vo.price, vo.isDefault, vo.createdAt as optionCreatedAt, vo.updatedAt as optionUpdatedAt
      FROM variation v
      LEFT JOIN variationoption vo ON v.id = vo.variationId
      WHERE v.id = ${a}
    `,w={id:A[0].id,name:A[0].name,description:A[0].description,createdAt:A[0].createdAt,updatedAt:A[0].updatedAt,variationoption:A[0].optionId?A.map(e=>({id:e.optionId,variationId:e.id,name:e.optionName,price:e.price,isDefault:e.isDefault,createdAt:e.optionCreatedAt,updatedAt:e.optionUpdatedAt})):[]};return s.NextResponse.json({message:"Varyasyon başarıyla g\xfcncellendi",variation:w})}catch(e){return console.error("Varyasyon g\xfcncellenirken hata:",e),s.NextResponse.json({error:"Varyasyon g\xfcncellenirken bir hata oluştu"},{status:500})}}async function f(e,{params:t}){try{let e=await (0,l.getServerSession)(p.N);if(!e||"ADMIN"!==e.user.role)return s.NextResponse.json({error:"Yetkisiz erişim"},{status:401});let{id:r}=t,a=await c.$queryRaw`
      SELECT * FROM variation WHERE id = ${r}
    `;if(!Array.isArray(a)||0===a.length)return s.NextResponse.json({error:"Varyasyon bulunamadı"},{status:404});let i=await c.$queryRaw`
      SELECT * FROM productvariation WHERE variationId = ${r}
    `;return Array.isArray(i)&&i.length>0&&await c.$executeRaw`DELETE FROM productvariation WHERE variationId = ${r}`,await c.$executeRaw`DELETE FROM variationoption WHERE variationId = ${r}`,await c.$executeRaw`DELETE FROM variation WHERE id = ${r}`,s.NextResponse.json({message:"Varyasyon başarıyla silindi"})}catch(e){return console.error("Varyasyon silinirken hata:",e),s.NextResponse.json({error:"Varyasyon silinirken bir hata oluştu"},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/admin/variations/[id]/route",pathname:"/api/admin/variations/[id]",filename:"route",bundlePath:"app/api/admin/variations/[id]/route"},resolvedPagePath:"C:\\Users\\Administrator\\Desktop\\restoran\\src\\app\\api\\admin\\variations\\[id]\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:E,workUnitAsyncStorage:g,serverHooks:A}=m;function w(){return(0,n.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:g})}},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31183:(e,t,r)=>{"use strict";r.d(t,{z:()=>i});var a=r(96330);let i=global.prisma||new a.PrismaClient({log:["error"]})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66541:e=>{"use strict";e.exports=require("@prisma/client/runtime/library")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},94735:e=>{"use strict";e.exports=require("events")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4243,580,5663,5252],()=>r(26362));module.exports=a})();