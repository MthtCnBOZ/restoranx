(()=>{var e={};e.id=1551,e.ids=[1551],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},12909:(e,t,r)=>{"use strict";r.d(t,{N:()=>l,p:()=>c});var s=r(16467),i=r(35426),o=r(13581),a=r(85663),n=r(31183);let l={adapter:(0,s.y)(n.z),session:{strategy:"jwt",maxAge:2592e3},pages:{signIn:"/giris"},providers:[(0,o.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Şifre",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await n.z.user.findUnique({where:{email:e.email}});return t&&t.password&&await (0,a.UD)(e.password,t.password)?(console.log("Giriş başarılı. Kullanıcı:",{id:t.id,email:t.email,name:t.name,role:t.role}),{id:t.id,email:t.email,name:t.name,role:t.role}):null}})],callbacks:{jwt:async({token:e,user:t,account:r})=>(console.log("JWT callback \xe7alışıyor"),console.log("User bilgisi:",t),console.log("\xd6nceki token:",e),t&&(e.id=t.id,e.role=t.role,console.log("JWT'ye yeni bilgiler eklendi:",e)),e),session:async({session:e,token:t})=>(console.log("Session callback \xe7alışıyor"),console.log("Token:",t),t&&(e.user.id=t.id,e.user.role=t.role,console.log("Session g\xfcncellenmiş hali:",e)),e)},debug:!1},c=()=>(0,i.getServerSession)(l)},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31183:(e,t,r)=>{"use strict";r.d(t,{z:()=>i});var s=r(96330);let i=global.prisma||new s.PrismaClient({log:["error"]})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65862:(e,t,r)=>{"use strict";r.d(t,{LR:()=>c,iT:()=>o,lt:()=>l,sR:()=>n});var s=r(55511),i=r.n(s);function o(e,t,r=!1){return console.log("İyzico config oluşturuldu - Sandbox modu:",r?"Aktif":"Kapalı"),{apiKey:e,secretKey:t,baseUrl:r?"https://sandbox-api.iyzipay.com":"https://api.iyzipay.com"}}async function a(e,t,r,s={}){let o=`${e.baseUrl}${r}`,n=function(e,t,r={}){let s=Math.random().toString(10).substring(2);r="string"==typeof r?r:JSON.stringify(r);let o=`[${s}${e.apiKey}${t}${r}${e.secretKey}]`,a=i().createHash("sha1").update(o).digest("base64");return`IYZWS ${e.apiKey}:${a}`}(e,r,s);try{let e=await fetch(o,{method:t,headers:{"Content-Type":"application/json",Authorization:n,Accept:"application/json","x-iyzi-client-version":"iyzico-node-client-1.0.0"},body:"GET"!==t?JSON.stringify(s):void 0}),r=await e.json();if("success"!==r.status)throw Error(r.errorMessage||"Iyzico API isteği başarısız oldu");return r}catch(e){throw console.error("Iyzico API hatası:",e),e}}async function n(e){try{console.log("İyzico bağlantı testi yapılıyor:",e.baseUrl);let t=await a(e,"GET","/payment/test");return console.log("İyzico test sonucu:",t),"success"===t.status}catch(e){return console.error("Iyzico bağlantı testi hatası:",e),!1}}async function l(e,t){try{return await a(e,"POST","/payment/iyzipos/checkoutform/initialize",t)}catch(e){throw console.error("Iyzico \xf6deme formu oluşturma hatası:",e),e}}async function c(e,t){try{return await a(e,"POST","/payment/iyzipos/checkoutform/auth/ecom/detail",{token:t})}catch(e){throw console.error("Iyzico \xf6deme sorgulama hatası:",e),e}}},66541:e=>{"use strict";e.exports=require("@prisma/client/runtime/library")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},93854:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>p,serverHooks:()=>m,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{POST:()=>u});var i=r(96559),o=r(48088),a=r(37719),n=r(32190),l=r(12909),c=r(65862);async function u(e){try{let t=await (0,l.p)();if(!t||"ADMIN"!==t.user.role)return n.NextResponse.json({error:"Bu işlem i\xe7in yetkiniz yok."},{status:403});let{apiKey:r,secretKey:s,sandbox:i}=await e.json();if(console.log("İyzico test istenen ayarlar:",{apiKey:r?.slice(0,5)+"...",secretKey:s?.slice(0,5)+"...",sandbox:i}),!r||!s)return n.NextResponse.json({error:"API Key ve Secret Key zorunludur."},{status:400});let o=!0===i||"true"===i;console.log("Sandbox modu (d\xfczeltilmiş):",o);let a=(0,c.iT)(r,s,o);if(!await (0,c.sR)(a))return n.NextResponse.json({error:"Iyzico bağlantı testi başarısız oldu. L\xfctfen API anahtarlarınızı kontrol edin."},{status:400});return n.NextResponse.json({message:"Iyzico bağlantı testi başarılı!",status:"success",sandbox:o},{status:200})}catch(e){return console.error("Iyzico test hatası:",e),n.NextResponse.json({error:e.message||"Iyzico bağlantı testi sırasında bir hata oluştu."},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/admin/payment/test-iyzico/route",pathname:"/api/admin/payment/test-iyzico",filename:"route",bundlePath:"app/api/admin/payment/test-iyzico/route"},resolvedPagePath:"C:\\Users\\Administrator\\Desktop\\restoran\\src\\app\\api\\admin\\payment\\test-iyzico\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:y,serverHooks:m}=p;function g(){return(0,a.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:y})}},94735:e=>{"use strict";e.exports=require("events")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,580,5663,5252],()=>r(93854));module.exports=s})();