module.exports = {

"[project]/.next-internal/server/app/api/admin/products/[id]/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route.runtime.dev.js [external] (next/dist/compiled/next-server/app-route.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page.runtime.dev.js [external] (next/dist/compiled/next-server/app-page.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/@prisma/client [external] (@prisma/client, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@prisma/client", () => require("@prisma/client"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/assert [external] (assert, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}}),
"[externals]/querystring [external] (querystring, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/@prisma/client/runtime/library [external] (@prisma/client/runtime/library, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@prisma/client/runtime/library", () => require("@prisma/client/runtime/library"));

module.exports = mod;
}}),
"[project]/src/lib/prisma.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "prisma": (()=>prisma)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs)");
;
const globalForPrisma = global;
const prisma = globalForPrisma.prisma || new __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__["PrismaClient"]({
    log: ("TURBOPACK compile-time truthy", 1) ? [
        'query',
        'error',
        'warn'
    ] : ("TURBOPACK unreachable", undefined)
});
if ("TURBOPACK compile-time truthy", 1) globalForPrisma.prisma = prisma;
}}),
"[project]/src/lib/auth.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "authOptions": (()=>authOptions),
    "getAuthSession": (()=>getAuthSession)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$auth$2f$prisma$2d$adapter$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@auth/prisma-adapter/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$next$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/next/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$credentials$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/providers/credentials.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$bcryptjs$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/bcryptjs/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/prisma.ts [app-route] (ecmascript)");
;
;
;
;
;
const authOptions = {
    adapter: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$auth$2f$prisma$2d$adapter$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PrismaAdapter"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"]),
    session: {
        strategy: "jwt",
        maxAge: 30 * 24 * 60 * 60
    },
    pages: {
        signIn: "/giris"
    },
    providers: [
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$credentials$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
            name: "Credentials",
            credentials: {
                email: {
                    label: "Email",
                    type: "email"
                },
                password: {
                    label: "Şifre",
                    type: "password"
                }
            },
            async authorize (credentials) {
                if (!credentials?.email || !credentials?.password) {
                    return null;
                }
                const user = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["prisma"].user.findUnique({
                    where: {
                        email: credentials.email
                    }
                });
                if (!user || !user.password) {
                    return null;
                }
                const isPasswordValid = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$bcryptjs$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["compare"])(credentials.password, user.password);
                if (!isPasswordValid) {
                    return null;
                }
                console.log("Giriş başarılı. Kullanıcı:", {
                    id: user.id,
                    email: user.email,
                    name: user.name,
                    role: user.role
                });
                return {
                    id: user.id,
                    email: user.email,
                    name: user.name,
                    role: user.role
                };
            }
        })
    ],
    callbacks: {
        async jwt ({ token, user, account }) {
            console.log("JWT callback çalışıyor");
            console.log("User bilgisi:", user);
            console.log("Önceki token:", token);
            if (user) {
                // Kullanıcı ilk kez giriş yaptığında
                token.id = user.id;
                token.role = user.role;
                console.log("JWT'ye yeni bilgiler eklendi:", token);
            }
            return token;
        },
        async session ({ session, token }) {
            console.log("Session callback çalışıyor");
            console.log("Token:", token);
            if (token) {
                // JWT'den gelen bilgileri session'a aktar
                session.user.id = token.id;
                session.user.role = token.role;
                console.log("Session güncellenmiş hali:", session);
            }
            return session;
        }
    },
    debug: ("TURBOPACK compile-time value", "development") === "development"
};
const getAuthSession = ()=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$next$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getServerSession"])(authOptions);
}}),
"[project]/src/app/api/admin/products/[id]/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "DELETE": (()=>DELETE),
    "GET": (()=>GET),
    "PATCH": (()=>PATCH)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$uuid$2f$dist$2f$esm$2f$v4$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__default__as__v4$3e$__ = __turbopack_context__.i("[project]/node_modules/uuid/dist/esm/v4.js [app-route] (ecmascript) <export default as v4>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/auth.ts [app-route] (ecmascript)");
;
;
;
;
;
const prisma = new __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__["PrismaClient"]();
async function GET(request, { params }) {
    try {
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getServerSession"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["authOptions"]);
        if (!session || session.user.role !== "ADMIN") {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Yetkisiz erişim"
            }, {
                status: 401
            });
        }
        const id = params.id;
        // Ürünü getir
        const productData = await prisma.$queryRaw`
      SELECT p.*, c.name as categoryName,
        CASE WHEN (SELECT COUNT(*) FROM productvariation WHERE productId = p.id) > 0 THEN true ELSE false END as hasVariations
      FROM product p
      LEFT JOIN category c ON p.categoryId = c.id
      WHERE p.id = ${id}
    `;
        if (!Array.isArray(productData) || productData.length === 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Ürün bulunamadı"
            }, {
                status: 404
            });
        }
        const productRow = productData[0];
        const product = {
            id: productRow.id,
            name: productRow.name,
            slug: productRow.slug,
            description: productRow.description,
            price: productRow.price,
            basePrice: productRow.basePrice,
            hasStock: productRow.hasStock,
            stockQuantity: productRow.stockQuantity,
            inStock: productRow.stockQuantity > 0,
            image: productRow.image,
            ingredients: productRow.ingredients || [],
            createdAt: productRow.createdAt,
            updatedAt: productRow.updatedAt,
            hasVariations: productRow.hasVariations,
            categoryId: productRow.categoryId,
            metaTitle: productRow.metaTitle,
            metaDesc: productRow.metaDesc,
            noIndex: productRow.noIndex,
            category: productRow.categoryName ? {
                id: productRow.categoryId,
                name: productRow.categoryName
            } : null
        };
        // Ekstra malzemeleri getir
        const extras = await prisma.$queryRaw`
      SELECT e.*
      FROM extra e
      JOIN productextra pe ON e.id = pe.extraId
      WHERE pe.productId = ${id}
    `;
        product.extras = extras;
        // Varyasyon bilgilerini getir
        if (product.hasVariations) {
            const variations = await prisma.$queryRaw`
        SELECT v.id, v.name, v.description
        FROM variation v
        JOIN productvariation pv ON v.id = pv.variationId
        WHERE pv.productId = ${id}
      `;
            // Her varyasyonun seçeneklerini getir
            const enhancedVariations = await Promise.all(variations.map(async (variation)=>{
                const options = await prisma.$queryRaw`
            SELECT id, name, price, isDefault
            FROM variationoption
            WHERE variationId = ${variation.id}
            ORDER BY createdAt ASC
          `;
                return {
                    ...variation,
                    options
                };
            }));
            product.variations = enhancedVariations;
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            product
        });
    } catch (error) {
        console.error("Ürün alınırken hata:", error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: "Ürün alınırken bir hata oluştu"
        }, {
            status: 500
        });
    }
}
async function PATCH(request, { params }) {
    try {
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getServerSession"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["authOptions"]);
        if (!session || session.user.role !== "ADMIN") {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Yetkisiz erişim"
            }, {
                status: 401
            });
        }
        const id = params.id;
        const body = await request.json();
        const { name, slug, description, price, basePrice, categoryId, hasStock, stockQuantity, image, ingredients, extraIds, hasVariations, variationIds, metaTitle, metaDesc, noIndex } = body;
        // Ürünün var olup olmadığını kontrol et
        const existingProduct = await prisma.$queryRaw`
      SELECT * FROM product WHERE id = ${id}
    `;
        if (!Array.isArray(existingProduct) || existingProduct.length === 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Ürün bulunamadı"
            }, {
                status: 404
            });
        }
        // Validasyon
        if (!name) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Ürün adı zorunludur"
            }, {
                status: 400
            });
        }
        if (!slug) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Slug alanı zorunludur"
            }, {
                status: 400
            });
        }
        if (hasVariations) {
            if (!basePrice || parseFloat(basePrice.toString()) <= 0) {
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    error: "Geçerli bir temel fiyat girmelisiniz"
                }, {
                    status: 400
                });
            }
            if (!variationIds || !Array.isArray(variationIds) || variationIds.length === 0) {
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    error: "En az bir varyasyon seçmelisiniz"
                }, {
                    status: 400
                });
            }
        } else {
            if (!price || parseFloat(price.toString()) <= 0) {
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    error: "Geçerli bir fiyat girmelisiniz"
                }, {
                    status: 400
                });
            }
        }
        if (!categoryId) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Kategori seçimi zorunludur"
            }, {
                status: 400
            });
        }
        // Ürünü güncelle
        await prisma.$executeRaw`
      UPDATE product 
      SET 
        name = ${name},
        slug = ${slug},
        description = ${description || ""},
        price = ${hasVariations ? 0 : parseFloat(price)},
        basePrice = ${hasVariations ? parseFloat(basePrice) : 0},
        categoryId = ${categoryId},
        hasStock = ${hasStock},
        stockQuantity = ${hasStock ? parseInt(stockQuantity) : 0},
        image = ${image || ""},
        ingredients = ${JSON.stringify(ingredients || [])},
        metaTitle = ${metaTitle || ""},
        metaDesc = ${metaDesc || ""},
        noIndex = ${noIndex === false ? false : true},
        updatedAt = NOW()
      WHERE id = ${id}
    `;
        // Ekstra malzemeleri güncelle
        if (extraIds && Array.isArray(extraIds)) {
            // Mevcut tüm ekstraları sil
            await prisma.$executeRaw`DELETE FROM productextra WHERE productId = ${id}`;
            // Yeni ekstraları ekle
            for (const extraId of extraIds){
                const peId = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$uuid$2f$dist$2f$esm$2f$v4$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__default__as__v4$3e$__["v4"])();
                await prisma.$executeRaw`
          INSERT INTO productextra (id, productId, extraId, createdAt, updatedAt)
          VALUES (${peId}, ${id}, ${extraId}, NOW(), NOW())
        `;
            }
        }
        // Varyasyon bilgilerini güncelle
        if (hasVariations) {
            // Mevcut tüm varyasyonları sil
            await prisma.$executeRaw`DELETE FROM productvariation WHERE productId = ${id}`;
            // Yeni varyasyonları ekle
            for (const variationId of variationIds){
                const pvId = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$uuid$2f$dist$2f$esm$2f$v4$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__default__as__v4$3e$__["v4"])();
                await prisma.$executeRaw`
          INSERT INTO productvariation (id, productId, variationId, createdAt, updatedAt)
          VALUES (${pvId}, ${id}, ${variationId}, NOW(), NOW())
        `;
            }
        } else {
            // Ürün artık varyasyonsuz ise tüm varyasyon ilişkilerini kaldır
            await prisma.$executeRaw`DELETE FROM productvariation WHERE productId = ${id}`;
        }
        // Güncellenmiş ürünü getir
        const updatedProductData = await prisma.$queryRaw`
      SELECT p.*, c.name as categoryName,
        CASE WHEN (SELECT COUNT(*) FROM productvariation WHERE productId = p.id) > 0 THEN true ELSE false END as hasVariations
      FROM product p
      LEFT JOIN category c ON p.categoryId = c.id
      WHERE p.id = ${id}
    `;
        const updatedProductRow = updatedProductData[0];
        const updatedProduct = {
            id: updatedProductRow.id,
            name: updatedProductRow.name,
            slug: updatedProductRow.slug,
            description: updatedProductRow.description,
            price: updatedProductRow.price,
            basePrice: updatedProductRow.basePrice,
            hasStock: updatedProductRow.hasStock,
            stockQuantity: updatedProductRow.stockQuantity,
            inStock: updatedProductRow.stockQuantity > 0,
            image: updatedProductRow.image,
            ingredients: updatedProductRow.ingredients || [],
            createdAt: updatedProductRow.createdAt,
            updatedAt: updatedProductRow.updatedAt,
            hasVariations: updatedProductRow.hasVariations,
            categoryId: updatedProductRow.categoryId,
            metaTitle: updatedProductRow.metaTitle,
            metaDesc: updatedProductRow.metaDesc,
            noIndex: updatedProductRow.noIndex,
            category: updatedProductRow.categoryName ? {
                id: updatedProductRow.categoryId,
                name: updatedProductRow.categoryName
            } : null
        };
        // Varyasyon bilgilerini getir
        if (updatedProduct.hasVariations) {
            const variations = await prisma.$queryRaw`
        SELECT v.id, v.name
        FROM variation v
        JOIN productvariation pv ON v.id = pv.variationId
        WHERE pv.productId = ${id}
      `;
            updatedProduct.variations = variations;
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: "Ürün başarıyla güncellendi",
            product: updatedProduct
        });
    } catch (error) {
        console.error("Ürün güncellenirken hata:", error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: "Ürün güncellenirken bir hata oluştu"
        }, {
            status: 500
        });
    }
}
async function DELETE(request, { params }) {
    try {
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getServerSession"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["authOptions"]);
        if (!session || session.user.role !== "ADMIN") {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Yetkisiz erişim"
            }, {
                status: 401
            });
        }
        const id = params.id;
        // Ürünün var olup olmadığını kontrol et
        const existingProduct = await prisma.$queryRaw`
      SELECT * FROM product WHERE id = ${id}
    `;
        if (!Array.isArray(existingProduct) || existingProduct.length === 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Ürün bulunamadı"
            }, {
                status: 404
            });
        }
        // Ürüne ait varyasyon ilişkilerini sil
        await prisma.$executeRaw`DELETE FROM productvariation WHERE productId = ${id}`;
        // Sepet/sipariş öğelerini kontrol et (varsa)
        try {
            await prisma.$executeRaw`DELETE FROM cartitem WHERE productId = ${id}`;
            await prisma.$executeRaw`DELETE FROM orderitem WHERE productId = ${id}`;
        } catch (e) {
            console.log("Sepet/sipariş öğeleri silinirken hata (ilişki olmayabilir):", e);
        }
        // Ürünü sil
        await prisma.$executeRaw`DELETE FROM product WHERE id = ${id}`;
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: "Ürün başarıyla silindi"
        });
    } catch (error) {
        console.error("Ürün silinirken hata:", error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: "Ürün silinirken bir hata oluştu"
        }, {
            status: 500
        });
    }
}
}}),

};

//# sourceMappingURL=%5Broot%20of%20the%20server%5D__0dfd60ab._.js.map